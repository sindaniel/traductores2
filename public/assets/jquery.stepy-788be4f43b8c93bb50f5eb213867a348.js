!function(t){var e={init:function(i){return this.each(function(){var a=t.extend({},t.fn.stepy.defaults,i),n=t(this).data("options",a),r=n.attr("id");(void 0===r||""==r)&&(r="stepy-"+t("."+n.attr("class")).index(this),n.attr("id",r));var s=t("<ul/>",{id:r+"-titles","class":"stepy-titles clearfix"});a.titleTarget?t(a.titleTarget).html(s):s.insertBefore(n),a.validate&&(jQuery.validator.setDefaults({ignore:a.ignore}),n.append('<div class="stepy-error clearfix"/>'));var l=n.children("fieldset"),c=void 0,o=void 0,d="",h="";l.each(function(i){c=t(this),c.addClass("step").attr("id",r+"-step-"+i).append('<p id="'+r+"-buttons-"+i+'" class="'+r+'-buttons"/>'),o=c.children("legend"),a.legend||o.hide(),d="",a.description&&(o.length?d="<span>"+o.html()+"</span>":t.error(r+": the legend element of the step "+(i+1)+" is required to set the description!")),h=c.attr("title"),h=""!=h?"<div>"+h+"</div>":"--",s.append('<li id="'+r+"-title-"+i+'">'+h+d+"</li>"),0==i?l.length>1&&e.createNextButton.call(n,i):(e.createBackButton.call(n,i),c.hide(),i<l.length-1&&e.createNextButton.call(n,i))});var f=s.children();f.first().addClass("current-step");var u=n.children(".finish");if(a.finishButton)if(u.length){var p=n.is("form"),v=void 0;a.finish&&p&&(v=n.attr("onsubmit"),n.attr("onsubmit","return false;")),u.click(function(t){if(a.finish&&!e.execute.call(n,a.finish,l.length-1))t.preventDefault();else if(p){v?n.attr("onsubmit",v):n.removeAttr("onsubmit");var i="submit"==u.attr("type");i||a.validate&&!e.validate.call(n,l.length-1)||n.submit()}}),u.appendTo(n.find("p:last"))}else t.error(r+': element with class name "finish" missing!');a.titleClick?f.click(function(){var i=f.filter(".current-step").attr("id").split("-"),r=parseInt(i[i.length-1],10),s=t(this).index();if(s>r){if(a.next&&!e.execute.call(n,a.next,s))return!1}else if(r>s&&a.back&&!e.execute.call(n,a.back,s))return!1;s!=r&&e.step.call(n,s+1)}):f.css("cursor","default"),l.delegate('input[type="text"], input[type="password"]',"keypress",function(e){var i=e.keyCode?e.keyCode:e.which;if(13==i){e.preventDefault();var a=t(this).parent().children("."+r+"-buttons");if(a.length){var n=a.children(".button-next");if(n.length)n.click();else{var s=a.children(".finish");s.length&&s.click()}}}}),l.first().find(":input:visible:enabled").first().select().focus()})},createBackButton:function(i){var a=this,n=this.attr("id"),r=this.data("options");t("<a/>",{id:n+"-back-"+i,href:"javascript:void(0);","class":"button-back btn btn-info",html:r.backLabel}).click(function(){(!r.back||e.execute.call(a,r.back,i-1))&&e.step.call(a,i-1+1)}).appendTo(t("#"+n+"-buttons-"+i))},createNextButton:function(i){var a=this,n=this.attr("id"),r=this.data("options");t("<a/>",{id:n+"-next-"+i,href:"javascript:void(0);","class":"button-next  btn btn-info",html:r.nextLabel}).click(function(){(!r.next||e.execute.call(a,r.next,i+1))&&e.step.call(a,i+1+1)}).appendTo(t("#"+n+"-buttons-"+i))},execute:function(t,e){var i=t.call(this,e+1);return i||void 0===i},step:function(i){i--;var a=this.children("fieldset");i>a.length-1&&(i=a.length-1);var n=this.data("options");if(max=i,n.validate)for(var r=!0,s=0;i>s;s++)if(r&=e.validate.call(this,s),n.block&&!r){max=s;break}a.hide().eq(max).show();var l=t("#"+this.attr("id")+"-titles").children();if(l.removeClass("current-step").eq(max).addClass("current-step"),this.is("form")){var c=void 0;c=max==i?a.eq(max).find(":input:enabled:visible"):a.eq(max).find(".error").select().focus(),c.first().select().focus()}return n.select&&n.select.call(this,max+1),this},validate:function(e){if(!this.is("form"))return!0;var i=this.children("fieldset").eq(e),a=!0,n=t("#"+this.attr("id")+"-titles").children().eq(e),r=this.data("options"),s=this.validate();return t(i.find(":input:enabled").get().reverse()).each(function(){var e=s.element(t(this));void 0===e&&(e=!0),a&=e,a?r.errorImage&&n.removeClass("error-image"):(r.errorImage&&n.addClass("error-image"),s.focusInvalid())}),a}};t.fn.stepy=function(i){return e[i]?e[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void t.error("Method "+i+" does not exist!"):e.init.apply(this,arguments)},t.fn.stepy.defaults={back:void 0,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:void 0,finishButton:!0,legend:!0,ignore:"",next:void 0,nextLabel:"Next &gt;",titleClick:!1,titleTarget:void 0,validate:!1,select:void 0}}(jQuery);